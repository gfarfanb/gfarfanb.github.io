<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $(document).ready(function()
    {
        let keywords = [
            'N√∫mero de Jugadores',
            'N√∫mero de Vendedores',
            'Maletas Meta',
            'Maletas Real',
            'Demos Meta',
            'Demos Real',
            'Citas Instant√°neas',
            'Citas',
            '4/14 Meta',
            '4/14 Real',
            'Referidos Meta',
            'Referidos Real',
            'N√∫mero de Ventas Meta',
            'N√∫mero de Ventas',
            'Ventas Meta',
            'Ventas Real',
            'Ventas Agregado',
            'Nuevos Pros',
            'Meta de Reclutamiento',
            'Reclutamiento Real',
            'Entrevistas',
            'Invitaciones'
        ];

        $('#count').click(function() {
            let txt = $('#info').val();
            let lines = txt.split(/\n/);

            let counters = new Map();
            keywords.forEach(function (keyword, i) {
                keyword = keyword.toLowerCase();
                keywords[i] = keyword;
                counters.set(keyword, 0);
            });

            let discarded = '<ul>';

            for(let i = 0; i < lines.length; i++) {
                let line = lines[i].trim();
                let accepted = false;

                if (!line && line.length == 0) {
                    continue;
                }

                keywords.forEach(function (keyword) {
                    if(accepted) {
                        return;
                    }

                    line = line.replace(/\s+/g, ' ');
                    
                    line = line.replace('1Ô∏è‚É£', '1');
                    line = line.replace('2Ô∏è‚É£', '2');
                    line = line.replace('3Ô∏è‚É£', '3');
                    line = line.replace('4Ô∏è‚É£', '4');
                    line = line.replace('5Ô∏è‚É£', '5');
                    line = line.replace('6Ô∏è‚É£', '6');
                    line = line.replace('7Ô∏è‚É£', '7');
                    line = line.replace('8Ô∏è‚É£', '8');
                    line = line.replace('9Ô∏è‚É£', '9');
                    line = line.replace('üîü', '10');
                    line = line.replace('0Ô∏è‚É£', '0');

                    line = line.toLowerCase();
                    
                    line = line.replace('# de jugadores', 'N√∫mero de Jugadores');
                    line = line.replace('# de vendedores', 'N√∫mero de Vendedores');
                    line = line.replace('meta rrhh', 'Meta de Reclutamiento');
                    line = line.replace('rrhh real', 'Reclutamiento Real');
                    line = line.replace('maleta real', 'Maletas Real');
                    line = line.replace('cita instant√°nea', 'Citas Instant√°neas');
                    line = line.replace('venta agregado', 'Ventas Agregado');
                    line = line.replace('monto de venta', 'Ventas Real');
                    line = line.replace('# ventas real', 'N√∫mero de Ventas');
                    line = line.replace('# ventas meta', 'N√∫mero de Ventas Meta');

                    line = line.toLowerCase();

                    if(line.includes(keyword)) {
                        let position = line.search(keyword);
                        let rightPart = line.substring(position + keyword.length, line.length);
                        let value = parseInt(rightPart.replace(/[^\d.-]/g, ''));
                        counters.set(keyword, counters.get(keyword) + value);
                        accepted = true;
                    }
                });

                if(!accepted) {
                    discarded += '<li>' + line + '</li>';
                }
            }
            discarded += '</ul>'

            let pesos = new Intl.NumberFormat('es-MX', {
                currency: 'MXN',
                style: 'currency',
            });
            let results = '<table>';

            counters.forEach(function (value, key) {
                results += '<tr>' + '<td>' + key + '</td><td>' + pesos.format(value) + '</td></tr>';
            });
            results += "</table>"

            $('#results').html(results);
            $('#discarded').html(discarded);
        });

        $('#clean').click(function() {
            $('#info').val('');
            $('#results').text('');
            $('#discarded').text('');
        });
    });
</script>
</head>
<body>

<h3>Analizador informes</h3>

<p>Pega los informes en la caja de texto</p>

<textarea id="info" rows="10" cols="50">
</textarea>

<br>
<button id="count">Contar</button>
<button id="clean">Limpiar</button>

<h4>Resultados</h4>
<p id="results"></p>

<h4>L√≠neas no le√≠das</h4>
<p id="discarded"></p>

</body>
</html>
